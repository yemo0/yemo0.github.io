<!DOCTYPE html><html lang="en" class="color-scheme overflow-y-scroll"> <head><!-- Global Metadata --><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1.0"><link rel="icon" type="image/svg+xml" href="/favicon.svg"><meta name="generator" content="Astro v4.16.13"><!-- Canonical URL --><link rel="canonical" href="https://yemo0.github.io/blog/2023-06-26/"><!-- Primary Meta Tags --><title>编译openwrt</title><meta name="title" content="编译openwrt"><meta name="description" content="Welcome to my website!"><!-- Open Graph / Facebook --><meta property="og:type" content="website"><meta property="og:url" content="https://yemo0.github.io/blog/2023-06-26/"><meta property="og:title" content="编译openwrt"><meta property="og:description" content="Welcome to my website!"><meta property="og:image" content="https://yemo0.github.io/placeholder-social.jpg"><!-- Twitter --><meta property="twitter:card" content="summary_large_image"><meta property="twitter:url" content="https://yemo0.github.io/blog/2023-06-26/"><meta property="twitter:title" content="编译openwrt"><meta property="twitter:description" content="Welcome to my website!"><meta property="twitter:image" content="https://yemo0.github.io/placeholder-social.jpg"><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Document</title><link rel="stylesheet" href="/_astro/_page_.DyEKq_nm.css">
<style>a[data-astro-cid-eimmu3lg]{display:inline-block;text-decoration:none}a[data-astro-cid-eimmu3lg].active{font-weight:bolder;border-bottom:2px solid}h1,h2,h3,h4,h5,h6,strong,b{color:#222}nav a{margin-right:10px}textarea{width:100%;font-size:16px}input{font-size:16px}content{line-height:1.6}table{width:100%}img{max-width:100%;height:auto}code{padding:2px 5px;background-color:#f2f2f2}pre{padding:1rem}pre>code{all:unset}blockquote{border:1px solid #999;color:#222;padding:2px 0 2px 20px;margin:0;font-style:italic}
</style><script type="module" src="/_astro/hoisted.CMregwEs.js"></script></head> <body class="flex-col dark:bg-neutral-1000 dark:text-slate-200">  <header class="w-11/12 md:w-3/5 mx-auto"> <div class="flex h-16 items-center justify-between mb-5"> <div class="text-2xl font-bold"> <a href="/"></a> <button accesskey="t" title="(Alt + T)"> <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"></path></svg> <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg> </button> </div> <nav class="hidden md:block"> <a href="/archives" data-astro-cid-eimmu3lg> Archive </a>  <a href="/tags" data-astro-cid-eimmu3lg> Tags </a>  <a href="https://qdoc.vercel.app/" target="_blank" data-astro-cid-eimmu3lg> Docs </a>  <a href="https://github.com/yemo0" target="_blank" data-astro-cid-eimmu3lg> GitHub </a>  </nav> <!-- Mobile menu --> <button class="md:hidden p-2" id="menu-button"> <svg id="open-menu" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true"> <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5"></path> </svg> <svg id="close-menu" x-description="Icon when menu is open." x-state:on="Menu open" x-state:off="Menu closed" class="h-6 w-6 hidden" :class="{ 'block': open, 'hidden': !(open) }" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true"> <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"></path> </svg> </button> </div> <!-- Mobile menu, show/hide based on menu state--> <nav class="md:hidden flex flex-col hidden" id="nav"> <a href="/archives" class="mb-2" data-astro-cid-eimmu3lg> Archive </a>  <a href="/tags" class="mb-2" data-astro-cid-eimmu3lg> Tags </a>  <a href="/Docs" class="mb-2" target="_blank" data-astro-cid-eimmu3lg> Docs </a>  <a href="/GitHub" class="mb-2" target="_blank" data-astro-cid-eimmu3lg> GitHub </a>  </nav> </header> <!-- Dark mode --> <script defer>
  // Icons
  const sunIcon = document.querySelector("#sun");
  const moonIcon = document.querySelector("#moon");

  // Theme Vars
  const userTheme = localStorage.getItem("theme");
  const systemTheme = window.matchMedia("(prefers-color-scheme: dark)").matches;

  // Icon Toggling
  const iconToggle = () => {
    moonIcon.classList.toggle("hidden");
    sunIcon.classList.toggle("hidden");
  };

  // Initial Theme Check
  const initTheme = () => {
    sunIcon.classList.add("hidden");
    moonIcon.classList.add("hidden");
    if (userTheme === "dark" || (!userTheme && systemTheme)) {
      document.documentElement.classList.add("dark");
      sunIcon.classList.remove("hidden");
      return;
    }
    moonIcon.classList.remove("hidden");
  };

  // Manual Theme Switch
  const themeSwitch = () => {
    if (document.documentElement.classList.contains("dark")) {
      document.documentElement.classList.remove("dark");
      localStorage.setItem("theme", "light");
      iconToggle();
      return;
    }
    document.documentElement.classList.add("dark");
    localStorage.setItem("theme", "dark");
    iconToggle();
  };

  // call theme switch on clicking buttons
  sunIcon.addEventListener("click", () => {
    themeSwitch();
  });
  moonIcon.addEventListener("click", () => {
    themeSwitch();
  });

  // invoke theme check on initial load
  initTheme();
</script> <!-- Mobile Menu -->  <main class="font-mono w-11/12 md:w-3/5 mx-auto mt-10"> <div class="suspension-panel hidden fixed right-4 bottom-5 md:right-12 md:bottom-20"> <button class="go-to-top bg-gray-200 w-10 h-10 p-3 rounded-full text-zinc-700"> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"></path></svg> </button> </div> <article class="prose md:max-w-[90ch] mx-auto dark:prose-invert prose-headings:mt-0 prose-p:mt-0 break-words dark:prose-code:text-zinc-800 dark:prose-headings:text-slate-200 prose-lead:w-full prose-lead:aspect-square"> <h1 class="m-0">编译openwrt</h1> <div class="mb-5"> <time datetime="2023-06-26T11:59:20.000Z"> Jun 26, 2023 </time>·&nbsp;7&nbsp;mins&nbsp;read
</div>  <h2 id="编译openwrt">编译openwrt</h2>
<p>环境ubuntu-20.04.2 安装依赖包</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="sh"><code><span class="line"><span style="color:#B392F0">apt</span><span style="color:#79B8FF"> -y</span><span style="color:#9ECBFF"> install</span><span style="color:#9ECBFF"> build-essential</span><span style="color:#9ECBFF"> asciidoc</span><span style="color:#9ECBFF"> binutils</span><span style="color:#9ECBFF"> bzip2</span><span style="color:#9ECBFF"> gawk</span><span style="color:#9ECBFF"> gettext</span><span style="color:#9ECBFF"> git</span><span style="color:#9ECBFF"> libncurses5-dev</span><span style="color:#9ECBFF"> libz-dev</span><span style="color:#9ECBFF"> patch</span><span style="color:#9ECBFF"> python3</span><span style="color:#9ECBFF"> python2.7</span><span style="color:#9ECBFF"> unzip</span><span style="color:#9ECBFF"> zlib1g-dev</span><span style="color:#9ECBFF"> lib32gcc1</span><span style="color:#9ECBFF"> libc6-dev-i386</span><span style="color:#9ECBFF"> subversion</span><span style="color:#9ECBFF"> flex</span><span style="color:#9ECBFF"> uglifyjs</span><span style="color:#9ECBFF"> git-core</span><span style="color:#9ECBFF"> gcc-multilib</span><span style="color:#9ECBFF"> p7zip</span><span style="color:#9ECBFF"> p7zip-full</span><span style="color:#9ECBFF"> msmtp</span><span style="color:#9ECBFF"> libssl-dev</span><span style="color:#9ECBFF"> texinfo</span><span style="color:#9ECBFF"> libglib2.0-dev</span><span style="color:#9ECBFF"> xmlto</span><span style="color:#9ECBFF"> qemu-utils</span><span style="color:#9ECBFF"> upx</span><span style="color:#9ECBFF"> libelf-dev</span><span style="color:#9ECBFF"> autoconf</span><span style="color:#9ECBFF"> automake</span><span style="color:#9ECBFF"> libtool</span><span style="color:#9ECBFF"> autopoint</span><span style="color:#9ECBFF"> device-tree-compiler</span><span style="color:#9ECBFF"> g++-multilib</span><span style="color:#9ECBFF"> antlr3</span><span style="color:#9ECBFF"> gperf</span><span style="color:#9ECBFF"> wget</span><span style="color:#9ECBFF"> curl</span><span style="color:#9ECBFF"> swig</span><span style="color:#9ECBFF"> rsync</span></span>
<span class="line"></span></code></pre>
<h3 id="拉取源码">拉取源码</h3>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="sh"><code><span class="line"><span style="color:#B392F0">git</span><span style="color:#9ECBFF"> clone</span><span style="color:#9ECBFF"> https://github.com/coolsnowwolf/lede.git</span><span style="color:#9ECBFF"> openwrt</span></span>
<span class="line"></span></code></pre>
<h2 id="下面操作不要用root账户">下面操作不要用root账户</h2>
<h3 id="添加软件源">添加软件源</h3>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="sh"><code><span class="line"><span style="color:#79B8FF">cd</span><span style="color:#9ECBFF"> openwrt</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># 软件源文件 喜欢什么添加什么</span></span>
<span class="line"><span style="color:#B392F0">feeds.conf.default</span></span>
<span class="line"></span></code></pre>
<h3 id="更新源-和-安装源">更新源 和 安装源</h3>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="sh"><code><span class="line"><span style="color:#B392F0">./scripts/feeds</span><span style="color:#9ECBFF"> update</span><span style="color:#79B8FF"> -a</span><span style="color:#E1E4E8"> &#x26;&#x26; </span><span style="color:#B392F0">./scripts/feeds</span><span style="color:#9ECBFF"> install</span><span style="color:#79B8FF"> -a</span></span>
<span class="line"></span></code></pre>
<h3 id="设置主题">设置主题</h3>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="sh"><code><span class="line"><span style="color:#6A737D"># 删除自定义源默认的 argon 主题</span></span>
<span class="line"><span style="color:#B392F0">rm</span><span style="color:#79B8FF"> -rf</span><span style="color:#9ECBFF"> package/lean/luci-theme-argon</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># 针对 LEDE 项目拉取 argon 原作者的源码</span></span>
<span class="line"><span style="color:#B392F0">git</span><span style="color:#9ECBFF"> clone</span><span style="color:#79B8FF"> -b</span><span style="color:#79B8FF"> 18.06</span><span style="color:#9ECBFF"> https://github.com/jerrykuku/luci-theme-argon.git</span><span style="color:#9ECBFF"> package/lean/luci-theme-argon</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># 替换默认主题为 luci-theme-argon</span></span>
<span class="line"><span style="color:#B392F0">sed</span><span style="color:#79B8FF"> -i</span><span style="color:#9ECBFF"> 's/luci-theme-bootstrap/luci-theme-argon/'</span><span style="color:#9ECBFF"> feeds/luci/collections/luci/Makefile</span></span>
<span class="line"></span></code></pre>
<h3 id="编译固件">编译固件</h3>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="sh"><code><span class="line"><span style="color:#B392F0">make</span><span style="color:#9ECBFF"> menuconfig</span></span>
<span class="line"></span></code></pre>
<p>执行后会进入菜单<br>
<code>Target System (x86)</code> 是编译目标<br>
<code>Target Images</code> 编译固件格式、有虚拟机的类型<br>
<code>Extra Packages</code> 支持<code>ipv6</code> 给<code>ipv6helper</code>选择上<br>
<code>Luci-->Applications</code> 软件包和添加源一样，喜欢啥就添加啥<br>
<strong>tip:</strong><br>
<code>*</code> 打包进固件内<br>
M 作为module<br>
open2 依赖 open1</p>
<h3 id="下载编译的软件包">下载编译的软件包</h3>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="sh"><code><span class="line"><span style="color:#B392F0">make</span><span style="color:#9ECBFF"> download</span><span style="color:#79B8FF"> -j8</span><span style="color:#9ECBFF"> V=s</span></span>
<span class="line"></span></code></pre>
<h3 id="单线程编译-openwrt">单线程编译 openwrt</h3>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="sh"><code><span class="line"><span style="color:#B392F0">make</span><span style="color:#79B8FF"> -j1</span><span style="color:#9ECBFF"> V=s</span></span>
<span class="line"></span></code></pre>
<p>编译时间巨长，2-3小时才能完成
编译输出位置<code>/openwrt/bin/targets/x86/64</code></p>
<h3 id="二次编译">二次编译</h3>
<p>先删除配置文件、再生成配置文件、然后编译<br>
第二次编译比较快 15分钟左右<br>
<strong>第二次编译是重新生成固件、重新生成固件、重新生成固件</strong></p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="sh"><code><span class="line"><span style="color:#B392F0">git</span><span style="color:#9ECBFF"> pull</span></span>
<span class="line"><span style="color:#B392F0">./scripts/feeds</span><span style="color:#9ECBFF"> update</span><span style="color:#79B8FF"> -a</span><span style="color:#E1E4E8"> &#x26;&#x26; </span><span style="color:#B392F0">./scripts/feeds</span><span style="color:#9ECBFF"> install</span><span style="color:#79B8FF"> -a</span></span>
<span class="line"><span style="color:#B392F0">make</span><span style="color:#9ECBFF"> defconfig</span></span>
<span class="line"><span style="color:#B392F0">make</span><span style="color:#79B8FF"> -j8</span><span style="color:#9ECBFF"> download</span></span>
<span class="line"><span style="color:#B392F0">make</span><span style="color:#79B8FF"> -j$(($(</span><span style="color:#B392F0">nproc</span><span style="color:#79B8FF">) + 1))</span><span style="color:#9ECBFF"> V=s</span></span>
<span class="line"></span></code></pre>
<p>重新配置软件</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="sh"><code><span class="line"><span style="color:#B392F0">rm</span><span style="color:#79B8FF"> -rf</span><span style="color:#9ECBFF"> ./tmp</span><span style="color:#E1E4E8"> &#x26;&#x26; </span><span style="color:#B392F0">rm</span><span style="color:#79B8FF"> -rf</span><span style="color:#9ECBFF"> .config</span></span>
<span class="line"><span style="color:#B392F0">make</span><span style="color:#9ECBFF"> menuconfig</span></span>
<span class="line"></span></code></pre>
<h3 id="参考">参考</h3>
<p><a href="https://www.moewah.com/archives/4003.html">OpenWrt 固件自编译教程</a>
<a href="https://www.drixn.com/2368.html">编译 Openwrt 固件</a></p>  <ul class="list-none flex p-0"> <a href="/tags/openwrt" class="no-underline"> <li class="px-4 py-2 mr-3 bg-neutral-400 border border-neutral-600 rounded-md
            dark:bg-neutral-900 dark:border-none"> openwrt </li> </a> </ul> </article> </main> <footer class="text-sm text-neutral-700 text-center py-6">
&copy; 2024&nbsp;Powered&nbsp;by
<a href="https://astro.build/">Astro</a>&nbsp;&
<a href="https://github.com/yemo0/just-my-type-blog">Just My Type</a> </footer>   </body></html>