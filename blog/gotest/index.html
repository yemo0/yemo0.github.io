<!DOCTYPE html><html lang="en" class="color-scheme overflow-y-scroll"> <head><!-- Global Metadata --><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1.0"><link rel="icon" type="image/svg+xml" href="/favicon.svg"><meta name="generator" content="Astro v4.16.17"><!-- Canonical URL --><link rel="canonical" href="https://yemo0.github.io/blog/gotest/"><!-- Primary Meta Tags --><title>go Test测试</title><meta name="title" content="go Test测试"><meta name="description" content="Welcome to my website!"><!-- Open Graph / Facebook --><meta property="og:type" content="website"><meta property="og:url" content="https://yemo0.github.io/blog/gotest/"><meta property="og:title" content="go Test测试"><meta property="og:description" content="Welcome to my website!"><meta property="og:image" content="https://yemo0.github.io/placeholder-social.jpg"><!-- Twitter --><meta property="twitter:card" content="summary_large_image"><meta property="twitter:url" content="https://yemo0.github.io/blog/gotest/"><meta property="twitter:title" content="go Test测试"><meta property="twitter:description" content="Welcome to my website!"><meta property="twitter:image" content="https://yemo0.github.io/placeholder-social.jpg"><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/_astro/_page_.DyEKq_nm.css">
<style>a[data-astro-cid-eimmu3lg]{display:inline-block;text-decoration:none}a[data-astro-cid-eimmu3lg].active{font-weight:bolder;border-bottom:2px solid}h1,h2,h3,h4,h5,h6,strong,b{color:#222}nav a{margin-right:10px}textarea{width:100%;font-size:16px}input{font-size:16px}content{line-height:1.6}table{width:100%}img{max-width:100%;height:auto}code{padding:2px 5px;background-color:#f2f2f2}pre{padding:1rem}pre>code{all:unset}blockquote{border:1px solid #999;color:#222;padding:2px 0 2px 20px;margin:0;font-style:italic}
</style><script type="module" src="/_astro/hoisted.CMregwEs.js"></script></head> <body class="flex-col dark:bg-neutral-1000 dark:text-slate-200"> <header class="w-11/12 md:w-3/5 mx-auto"> <div class="flex h-16 items-center justify-between mb-5"> <div class="text-2xl font-bold"> <a href="/">Home</a> <button accesskey="t" title="(Alt + T)"> <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"></path></svg> <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg> </button> </div> <nav class="hidden md:block"> <a href="/archives" data-astro-cid-eimmu3lg> Archive </a>  <a href="/tags" data-astro-cid-eimmu3lg> Tags </a>  <a href="https://qdoc.vercel.app/" target="_blank" data-astro-cid-eimmu3lg> Docs </a>  <a href="https://github.com/yemo0" target="_blank" data-astro-cid-eimmu3lg> GitHub </a>  </nav> <!-- Mobile menu --> <button class="md:hidden p-2" id="menu-button"> <svg id="open-menu" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true"> <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5"></path> </svg> <svg id="close-menu" x-description="Icon when menu is open." x-state:on="Menu open" x-state:off="Menu closed" class="h-6 w-6 hidden" :class="{ 'block': open, 'hidden': !(open) }" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true"> <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"></path> </svg> </button> </div> <!-- Mobile menu, show/hide based on menu state--> <nav class="md:hidden flex flex-col hidden" id="nav"> <a href="/archives" class="mb-2" data-astro-cid-eimmu3lg> Archive </a>  <a href="/tags" class="mb-2" data-astro-cid-eimmu3lg> Tags </a>  <a href="/Docs" class="mb-2" target="_blank" data-astro-cid-eimmu3lg> Docs </a>  <a href="/GitHub" class="mb-2" target="_blank" data-astro-cid-eimmu3lg> GitHub </a>  </nav> </header> <!-- Dark mode --> <script defer>
  // Icons
  const sunIcon = document.querySelector("#sun");
  const moonIcon = document.querySelector("#moon");

  // Theme Vars
  const userTheme = localStorage.getItem("theme");
  const systemTheme = window.matchMedia("(prefers-color-scheme: dark)").matches;

  // Icon Toggling
  const iconToggle = () => {
    moonIcon.classList.toggle("hidden");
    sunIcon.classList.toggle("hidden");
  };

  // Initial Theme Check
  const initTheme = () => {
    sunIcon.classList.add("hidden");
    moonIcon.classList.add("hidden");
    if (userTheme === "dark" || (!userTheme && systemTheme)) {
      document.documentElement.classList.add("dark");
      sunIcon.classList.remove("hidden");
      return;
    }
    moonIcon.classList.remove("hidden");
  };

  // Manual Theme Switch
  const themeSwitch = () => {
    if (document.documentElement.classList.contains("dark")) {
      document.documentElement.classList.remove("dark");
      localStorage.setItem("theme", "light");
      iconToggle();
      return;
    }
    document.documentElement.classList.add("dark");
    localStorage.setItem("theme", "dark");
    iconToggle();
  };

  // call theme switch on clicking buttons
  sunIcon.addEventListener("click", () => {
    themeSwitch();
  });
  moonIcon.addEventListener("click", () => {
    themeSwitch();
  });

  // invoke theme check on initial load
  initTheme();
</script> <!-- Mobile Menu -->   <main class="font-mono w-11/12 md:w-3/5 mx-auto mt-10"> <div class="suspension-panel hidden fixed right-4 bottom-5 md:right-12 md:bottom-20"> <button class="go-to-top bg-gray-200 w-10 h-10 p-3 rounded-full text-zinc-700"> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"></path></svg> </button> </div> <article class="prose md:max-w-[90ch] mx-auto dark:prose-invert prose-headings:mt-0 prose-p:mt-0 break-words dark:prose-code:text-zinc-800 dark:prose-headings:text-slate-200 prose-lead:w-full prose-lead:aspect-square"> <h1 class="m-0">go Test测试</h1> <div class="mb-5"> <time datetime="2021-08-19T13:05:46.000Z"> Aug 19, 2021 </time>·&nbsp;15&nbsp;mins&nbsp;read
</div>  
























<table><thead><tr><th>类型</th><th>函数名前缀</th><th>作用</th></tr></thead><tbody><tr><td>测试函数</td><td>函数名前缀为Test</td><td>测试程序的一些逻辑行为是否正确</td></tr><tr><td>基准函数</td><td>函数名前缀为Benchmark</td><td>测试函数的性能</td></tr><tr><td>示例函数</td><td>函数名前缀为Example</td><td>为文档提供示例文档</td></tr></tbody></table>
<h3 id="测试函数">测试函数</h3>
<p>测试函数必须导入<code>testing</code>包 。</p>
<p>基本格式</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="go"><code><span class="line"><span style="color:#E1E4E8">function </span><span style="color:#B392F0">TestName</span><span style="color:#E1E4E8">(t </span><span style="color:#F97583">*</span><span style="color:#E1E4E8">testing.T) {}</span></span>
<span class="line"></span></code></pre>
<p>其中参数<code>t</code>用于报告测试失败和附加的日志信息。 <code>testing.T</code>的拥有的方法如下</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="go"><code><span class="line"><span style="color:#F97583">func</span><span style="color:#E1E4E8"> (</span><span style="color:#FFAB70">c </span><span style="color:#F97583">*</span><span style="color:#B392F0">T</span><span style="color:#E1E4E8">) </span><span style="color:#B392F0">Error</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">args</span><span style="color:#F97583"> ...interface</span><span style="color:#E1E4E8">{})</span></span>
<span class="line"><span style="color:#F97583">func</span><span style="color:#E1E4E8"> (</span><span style="color:#FFAB70">c </span><span style="color:#F97583">*</span><span style="color:#B392F0">T</span><span style="color:#E1E4E8">) </span><span style="color:#B392F0">Errorf</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">format</span><span style="color:#F97583"> string</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">args</span><span style="color:#F97583"> ...interface</span><span style="color:#E1E4E8">{})</span></span>
<span class="line"><span style="color:#F97583">func</span><span style="color:#E1E4E8"> (</span><span style="color:#FFAB70">c </span><span style="color:#F97583">*</span><span style="color:#B392F0">T</span><span style="color:#E1E4E8">) </span><span style="color:#B392F0">Fail</span><span style="color:#E1E4E8">()</span></span>
<span class="line"><span style="color:#F97583">func</span><span style="color:#E1E4E8"> (</span><span style="color:#FFAB70">c </span><span style="color:#F97583">*</span><span style="color:#B392F0">T</span><span style="color:#E1E4E8">) </span><span style="color:#B392F0">FailNow</span><span style="color:#E1E4E8">()</span></span>
<span class="line"><span style="color:#F97583">func</span><span style="color:#E1E4E8"> (</span><span style="color:#FFAB70">c </span><span style="color:#F97583">*</span><span style="color:#B392F0">T</span><span style="color:#E1E4E8">) </span><span style="color:#B392F0">Failed</span><span style="color:#E1E4E8">() </span><span style="color:#F97583">bool</span></span>
<span class="line"><span style="color:#F97583">func</span><span style="color:#E1E4E8"> (</span><span style="color:#FFAB70">c </span><span style="color:#F97583">*</span><span style="color:#B392F0">T</span><span style="color:#E1E4E8">) </span><span style="color:#B392F0">Fatal</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">args</span><span style="color:#F97583"> ...interface</span><span style="color:#E1E4E8">{})</span></span>
<span class="line"><span style="color:#F97583">func</span><span style="color:#E1E4E8"> (</span><span style="color:#FFAB70">c </span><span style="color:#F97583">*</span><span style="color:#B392F0">T</span><span style="color:#E1E4E8">) </span><span style="color:#B392F0">Fatalf</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">format</span><span style="color:#F97583"> string</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">args</span><span style="color:#F97583"> ...interface</span><span style="color:#E1E4E8">{})</span></span>
<span class="line"><span style="color:#F97583">func</span><span style="color:#E1E4E8"> (</span><span style="color:#FFAB70">c </span><span style="color:#F97583">*</span><span style="color:#B392F0">T</span><span style="color:#E1E4E8">) </span><span style="color:#B392F0">Log</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">args</span><span style="color:#F97583"> ...interface</span><span style="color:#E1E4E8">{})</span></span>
<span class="line"><span style="color:#F97583">func</span><span style="color:#E1E4E8"> (</span><span style="color:#FFAB70">c </span><span style="color:#F97583">*</span><span style="color:#B392F0">T</span><span style="color:#E1E4E8">) </span><span style="color:#B392F0">Logf</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">format</span><span style="color:#F97583"> string</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">args</span><span style="color:#F97583"> ...interface</span><span style="color:#E1E4E8">{})</span></span>
<span class="line"><span style="color:#F97583">func</span><span style="color:#E1E4E8"> (</span><span style="color:#FFAB70">c </span><span style="color:#F97583">*</span><span style="color:#B392F0">T</span><span style="color:#E1E4E8">) </span><span style="color:#B392F0">Name</span><span style="color:#E1E4E8">() </span><span style="color:#F97583">string</span></span>
<span class="line"><span style="color:#F97583">func</span><span style="color:#E1E4E8"> (</span><span style="color:#FFAB70">t </span><span style="color:#F97583">*</span><span style="color:#B392F0">T</span><span style="color:#E1E4E8">) </span><span style="color:#B392F0">Parallel</span><span style="color:#E1E4E8">()</span></span>
<span class="line"><span style="color:#F97583">func</span><span style="color:#E1E4E8"> (</span><span style="color:#FFAB70">t </span><span style="color:#F97583">*</span><span style="color:#B392F0">T</span><span style="color:#E1E4E8">) </span><span style="color:#B392F0">Run</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">name</span><span style="color:#F97583"> string</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">f</span><span style="color:#F97583"> func</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">t</span><span style="color:#F97583"> *</span><span style="color:#B392F0">T</span><span style="color:#E1E4E8">)) </span><span style="color:#F97583">bool</span></span>
<span class="line"><span style="color:#F97583">func</span><span style="color:#E1E4E8"> (</span><span style="color:#FFAB70">c </span><span style="color:#F97583">*</span><span style="color:#B392F0">T</span><span style="color:#E1E4E8">) </span><span style="color:#B392F0">Skip</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">args</span><span style="color:#F97583"> ...interface</span><span style="color:#E1E4E8">{})</span></span>
<span class="line"><span style="color:#F97583">func</span><span style="color:#E1E4E8"> (</span><span style="color:#FFAB70">c </span><span style="color:#F97583">*</span><span style="color:#B392F0">T</span><span style="color:#E1E4E8">) </span><span style="color:#B392F0">SkipNow</span><span style="color:#E1E4E8">()</span></span>
<span class="line"><span style="color:#F97583">func</span><span style="color:#E1E4E8"> (</span><span style="color:#FFAB70">c </span><span style="color:#F97583">*</span><span style="color:#B392F0">T</span><span style="color:#E1E4E8">) </span><span style="color:#B392F0">Skipf</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">format</span><span style="color:#F97583"> string</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">args</span><span style="color:#F97583"> ...interface</span><span style="color:#E1E4E8">{})</span></span>
<span class="line"><span style="color:#F97583">func</span><span style="color:#E1E4E8"> (</span><span style="color:#FFAB70">c </span><span style="color:#F97583">*</span><span style="color:#B392F0">T</span><span style="color:#E1E4E8">) </span><span style="color:#B392F0">Skipped</span><span style="color:#E1E4E8">() </span><span style="color:#F97583">bool</span></span>
<span class="line"></span></code></pre>
<h4 id="案例演示">案例演示</h4>
<p><code>main.go</code></p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="go"><code><span class="line"><span style="color:#F97583">package</span><span style="color:#B392F0"> main</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">func</span><span style="color:#B392F0"> Sum</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">a</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">b</span><span style="color:#F97583"> int</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">int</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">	return</span><span style="color:#E1E4E8"> a </span><span style="color:#F97583">+</span><span style="color:#E1E4E8"> b</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span></code></pre>
<p><code>sum_test.go</code></p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="go"><code><span class="line"><span style="color:#F97583">package</span><span style="color:#B392F0"> main</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">import</span><span style="color:#9ECBFF"> "</span><span style="color:#B392F0">testing</span><span style="color:#9ECBFF">"</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">func</span><span style="color:#B392F0"> TestSum</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">t</span><span style="color:#F97583"> *</span><span style="color:#B392F0">testing</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">T</span><span style="color:#E1E4E8">)  {</span></span>
<span class="line"><span style="color:#E1E4E8">   res </span><span style="color:#F97583">:=</span><span style="color:#B392F0"> Sum</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">4</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#F97583">   if</span><span style="color:#E1E4E8"> res </span><span style="color:#F97583">!=</span><span style="color:#79B8FF"> 3</span><span style="color:#E1E4E8">{</span></span>
<span class="line"><span style="color:#E1E4E8">      t.</span><span style="color:#B392F0">Error</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"sum is wrong"</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">   } </span><span style="color:#F97583">else</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">      t.</span><span style="color:#B392F0">Log</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"sum is ok"</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">   }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span></code></pre>
<p>运行go test -v</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="go"><code><span class="line"><span style="color:#F97583">===</span><span style="color:#E1E4E8"> RUN   TestSum</span></span>
<span class="line"><span style="color:#E1E4E8">    sum_test.</span><span style="color:#F97583">go</span><span style="color:#E1E4E8">:</span><span style="color:#79B8FF">10</span><span style="color:#E1E4E8">: sum is ok</span></span>
<span class="line"><span style="color:#F97583">---</span><span style="color:#E1E4E8"> PASS: TestSum (</span><span style="color:#FDAEB7;font-style:italic">0.00s</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">PASS</span></span>
<span class="line"><span style="color:#E1E4E8">ok      _</span><span style="color:#F97583">/</span><span style="color:#E1E4E8">C_</span><span style="color:#F97583">/</span><span style="color:#E1E4E8">Users</span><span style="color:#F97583">/</span><span style="color:#E1E4E8">???</span><span style="color:#F97583">/</span><span style="color:#E1E4E8">Desktop</span><span style="color:#F97583">/go/</span><span style="color:#E1E4E8">test</span><span style="color:#F97583">/</span><span style="color:#E1E4E8">testing        </span><span style="color:#FDAEB7;font-style:italic">0.042s</span></span>
<span class="line"></span></code></pre>
<h3 id="测试组">测试组</h3>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="go"><code><span class="line"><span style="color:#F97583">package</span><span style="color:#B392F0"> main</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">import</span><span style="color:#E1E4E8"> (</span></span>
<span class="line"><span style="color:#9ECBFF">   "</span><span style="color:#B392F0">reflect</span><span style="color:#9ECBFF">"</span></span>
<span class="line"><span style="color:#9ECBFF">   "</span><span style="color:#B392F0">testing</span><span style="color:#9ECBFF">"</span></span>
<span class="line"><span style="color:#E1E4E8">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">func</span><span style="color:#B392F0"> TestSum</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">t</span><span style="color:#F97583"> *</span><span style="color:#B392F0">testing</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">T</span><span style="color:#E1E4E8">)  {</span></span>
<span class="line"><span style="color:#F97583">   type</span><span style="color:#B392F0"> testCase</span><span style="color:#F97583"> struct</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">      a </span><span style="color:#F97583">int</span></span>
<span class="line"><span style="color:#E1E4E8">      b </span><span style="color:#F97583">int</span></span>
<span class="line"><span style="color:#E1E4E8">      w </span><span style="color:#F97583">int</span></span>
<span class="line"><span style="color:#E1E4E8">   }</span></span>
<span class="line"><span style="color:#E1E4E8">   testGroup </span><span style="color:#F97583">:=</span><span style="color:#E1E4E8"> []</span><span style="color:#B392F0">testCase</span><span style="color:#E1E4E8">{</span></span>
<span class="line"><span style="color:#E1E4E8">      {a: </span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">, b: </span><span style="color:#79B8FF">2</span><span style="color:#E1E4E8">, w: </span><span style="color:#79B8FF">3</span><span style="color:#E1E4E8">},</span></span>
<span class="line"><span style="color:#E1E4E8">      {a: </span><span style="color:#79B8FF">3</span><span style="color:#E1E4E8">, b: </span><span style="color:#79B8FF">2</span><span style="color:#E1E4E8">, w: </span><span style="color:#79B8FF">5</span><span style="color:#E1E4E8">},</span></span>
<span class="line"><span style="color:#E1E4E8">      {a: </span><span style="color:#79B8FF">3</span><span style="color:#E1E4E8">, b: </span><span style="color:#79B8FF">2</span><span style="color:#E1E4E8">, w: </span><span style="color:#79B8FF">6</span><span style="color:#E1E4E8">},</span></span>
<span class="line"><span style="color:#E1E4E8">   }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">   for</span><span style="color:#E1E4E8"> _, v </span><span style="color:#F97583">:=</span><span style="color:#F97583"> range</span><span style="color:#E1E4E8"> testGroup{</span></span>
<span class="line"><span style="color:#E1E4E8">      res </span><span style="color:#F97583">:=</span><span style="color:#B392F0"> Sum</span><span style="color:#E1E4E8">(v.a, v.b)</span></span>
<span class="line"><span style="color:#F97583">      if</span><span style="color:#F97583"> !</span><span style="color:#E1E4E8">reflect.</span><span style="color:#B392F0">DeepEqual</span><span style="color:#E1E4E8">(res, v.w) {</span></span>
<span class="line"><span style="color:#E1E4E8">         t.</span><span style="color:#B392F0">Error</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"sum is wrong"</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">      } </span><span style="color:#F97583">else</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">         t.</span><span style="color:#B392F0">Log</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"sum is ok"</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">      }</span></span>
<span class="line"><span style="color:#E1E4E8">   }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span></code></pre>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="go"><code><span class="line"><span style="color:#F97583">===</span><span style="color:#E1E4E8"> RUN   TestSum</span></span>
<span class="line"><span style="color:#E1E4E8">    sum_test.</span><span style="color:#F97583">go</span><span style="color:#E1E4E8">:</span><span style="color:#79B8FF">32</span><span style="color:#E1E4E8">: sum is ok</span></span>
<span class="line"><span style="color:#E1E4E8">    sum_test.</span><span style="color:#F97583">go</span><span style="color:#E1E4E8">:</span><span style="color:#79B8FF">32</span><span style="color:#E1E4E8">: sum is ok</span></span>
<span class="line"><span style="color:#E1E4E8">    sum_test.</span><span style="color:#F97583">go</span><span style="color:#E1E4E8">:</span><span style="color:#79B8FF">30</span><span style="color:#E1E4E8">: sum is wrong</span></span>
<span class="line"><span style="color:#F97583">---</span><span style="color:#E1E4E8"> FAIL: TestSum (</span><span style="color:#FDAEB7;font-style:italic">0.00s</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">FAIL</span></span>
<span class="line"><span style="color:#E1E4E8">exit status </span><span style="color:#79B8FF">1</span></span>
<span class="line"><span style="color:#E1E4E8">FAIL    _</span><span style="color:#F97583">/</span><span style="color:#E1E4E8">C_</span><span style="color:#F97583">/</span><span style="color:#E1E4E8">Users</span><span style="color:#F97583">/</span><span style="color:#E1E4E8">???</span><span style="color:#F97583">/</span><span style="color:#E1E4E8">Desktop</span><span style="color:#F97583">/go/</span><span style="color:#E1E4E8">test</span><span style="color:#F97583">/</span><span style="color:#E1E4E8">testing        </span><span style="color:#FDAEB7;font-style:italic">0.043s</span></span>
<span class="line"></span></code></pre>
<h3 id="子测试">子测试</h3>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="go"><code><span class="line"><span style="color:#F97583">func</span><span style="color:#B392F0"> TestSum</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">t</span><span style="color:#F97583"> *</span><span style="color:#B392F0">testing</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">T</span><span style="color:#E1E4E8">)  {</span></span>
<span class="line"><span style="color:#6A737D">	//res := Sum(1, 4)</span></span>
<span class="line"><span style="color:#6A737D">	//if res != 3{</span></span>
<span class="line"><span style="color:#6A737D">	//	t.Error("sum is wrong")</span></span>
<span class="line"><span style="color:#6A737D">	//} else {</span></span>
<span class="line"><span style="color:#6A737D">	//	t.Log("sum is ok")</span></span>
<span class="line"><span style="color:#6A737D">	//}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">	type</span><span style="color:#B392F0"> testCase</span><span style="color:#F97583"> struct</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">		a </span><span style="color:#F97583">int</span></span>
<span class="line"><span style="color:#E1E4E8">		b </span><span style="color:#F97583">int</span></span>
<span class="line"><span style="color:#E1E4E8">		w </span><span style="color:#F97583">int</span></span>
<span class="line"><span style="color:#E1E4E8">	}</span></span>
<span class="line"><span style="color:#E1E4E8">	testGroup </span><span style="color:#F97583">:=</span><span style="color:#F97583"> map</span><span style="color:#E1E4E8">[</span><span style="color:#F97583">string</span><span style="color:#E1E4E8">]</span><span style="color:#B392F0">testCase</span><span style="color:#E1E4E8">{</span></span>
<span class="line"><span style="color:#9ECBFF">		"case_1"</span><span style="color:#E1E4E8">: {a: </span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">, b: </span><span style="color:#79B8FF">2</span><span style="color:#E1E4E8">, w: </span><span style="color:#79B8FF">3</span><span style="color:#E1E4E8">},</span></span>
<span class="line"><span style="color:#9ECBFF">		"case_2"</span><span style="color:#E1E4E8">: {a: </span><span style="color:#79B8FF">3</span><span style="color:#E1E4E8">, b: </span><span style="color:#79B8FF">2</span><span style="color:#E1E4E8">, w: </span><span style="color:#79B8FF">5</span><span style="color:#E1E4E8">},</span></span>
<span class="line"><span style="color:#9ECBFF">		"case_3"</span><span style="color:#E1E4E8">: {a: </span><span style="color:#79B8FF">3</span><span style="color:#E1E4E8">, b: </span><span style="color:#79B8FF">2</span><span style="color:#E1E4E8">, w: </span><span style="color:#79B8FF">6</span><span style="color:#E1E4E8">},</span></span>
<span class="line"><span style="color:#E1E4E8">	}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">	for</span><span style="color:#E1E4E8"> k, v </span><span style="color:#F97583">:=</span><span style="color:#F97583"> range</span><span style="color:#E1E4E8"> testGroup{</span></span>
<span class="line"><span style="color:#E1E4E8">		t.</span><span style="color:#B392F0">Run</span><span style="color:#E1E4E8">(k, </span><span style="color:#F97583">func</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">t</span><span style="color:#F97583"> *</span><span style="color:#B392F0">testing</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">T</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#E1E4E8">			res </span><span style="color:#F97583">:=</span><span style="color:#B392F0"> Sum</span><span style="color:#E1E4E8">(v.a, v.b)</span></span>
<span class="line"><span style="color:#F97583">			if</span><span style="color:#F97583"> !</span><span style="color:#E1E4E8">reflect.</span><span style="color:#B392F0">DeepEqual</span><span style="color:#E1E4E8">(res, v.w) {</span></span>
<span class="line"><span style="color:#E1E4E8">				t.</span><span style="color:#B392F0">Error</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"sum is wrong"</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">			} </span><span style="color:#F97583">else</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">				t.</span><span style="color:#B392F0">Log</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"sum is ok"</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">			}</span></span>
<span class="line"><span style="color:#E1E4E8">		})</span></span>
<span class="line"><span style="color:#E1E4E8">	}</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span></code></pre>
<p><code>go test -run=TestSum/case_1</code></p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="go"><code><span class="line"><span style="color:#E1E4E8">testing: warning: no tests to run</span></span>
<span class="line"><span style="color:#E1E4E8">PASS</span></span>
<span class="line"><span style="color:#E1E4E8">ok      _</span><span style="color:#F97583">/</span><span style="color:#E1E4E8">C_</span><span style="color:#F97583">/</span><span style="color:#E1E4E8">Users</span><span style="color:#F97583">/</span><span style="color:#E1E4E8">???</span><span style="color:#F97583">/</span><span style="color:#E1E4E8">Desktop</span><span style="color:#F97583">/go/</span><span style="color:#E1E4E8">test</span><span style="color:#F97583">/</span><span style="color:#E1E4E8">testing        </span><span style="color:#FDAEB7;font-style:italic">0.037s</span></span>
<span class="line"></span></code></pre>
<h3 id="测试覆盖">测试覆盖</h3>
<p>Go提供内置功能来检查你的代码覆盖率 ,使用<code>go test -cover</code></p>
<p>使用<code>-coverprofile</code>额外参数，将覆盖信息记录输出到文件</p>
<h3 id="基准测试">基准测试</h3>
<p><code>main.go</code></p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="go"><code><span class="line"><span style="color:#F97583">package</span><span style="color:#B392F0"> main</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">func</span><span style="color:#B392F0"> Sum</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">a</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">b</span><span style="color:#F97583"> int</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">int</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">	return</span><span style="color:#E1E4E8"> a </span><span style="color:#F97583">+</span><span style="color:#E1E4E8"> b</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span></code></pre>
<p><code>sum_test.go</code></p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="go"><code><span class="line"><span style="color:#F97583">package</span><span style="color:#B392F0"> main</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">import</span><span style="color:#E1E4E8"> (</span></span>
<span class="line"><span style="color:#9ECBFF">	"</span><span style="color:#B392F0">testing</span><span style="color:#9ECBFF">"</span></span>
<span class="line"><span style="color:#E1E4E8">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">func</span><span style="color:#B392F0"> BenchmarkSum</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">b</span><span style="color:#F97583"> *</span><span style="color:#B392F0">testing</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">B</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#F97583">	for</span><span style="color:#E1E4E8"> i </span><span style="color:#F97583">:=</span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8">; i </span><span style="color:#F97583">&#x3C;</span><span style="color:#E1E4E8"> b.N; i</span><span style="color:#F97583">++</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#B392F0">		Sum</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">2</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">3</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">	}</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span></code></pre>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>❯ go test -bench=Sum    </span></span>
<span class="line"><span>goos: linux</span></span>
<span class="line"><span>goarch: amd64</span></span>
<span class="line"><span>pkg: benchmark</span></span>
<span class="line"><span>cpu: Intel(R) Xeon(R) CPU E5-2689 0 @ 2.60GHz</span></span>
<span class="line"><span>BenchmarkSum-4          1000000000               0.4147 ns/op</span></span>
<span class="line"><span>PASS</span></span>
<span class="line"><span>ok      benchmark       0.473s</span></span>
<span class="line"><span></span></span></code></pre>
<p>其中<code>BenchmarkSplit-8</code>表示对Split函数进行基准测试，数字<code>8</code>表示<code>GOMAXPROCS</code>的值，这个对于并发基准测试很重要。<code>1000000000 </code>和<code>203ns/op</code>表示每次调用<code>Sum</code>函数耗时<code>0.4147ns </code>，这个结果是<code>1000000000</code>次调用的平均值。</p>
<p>使用 <code>-benchmem</code>参数。获取内存分配统计数据</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="bash"><code><span class="line"><span style="color:#B392F0">❯</span><span style="color:#9ECBFF"> go</span><span style="color:#9ECBFF"> test</span><span style="color:#79B8FF"> -bench=Sum</span><span style="color:#79B8FF"> -benchmem</span><span style="color:#E1E4E8"> </span></span>
<span class="line"><span style="color:#B392F0">goos:</span><span style="color:#9ECBFF"> linux</span></span>
<span class="line"><span style="color:#B392F0">goarch:</span><span style="color:#9ECBFF"> amd64</span></span>
<span class="line"><span style="color:#B392F0">pkg:</span><span style="color:#9ECBFF"> benchmark</span></span>
<span class="line"><span style="color:#B392F0">cpu:</span><span style="color:#9ECBFF"> Intel</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">R</span><span style="color:#E1E4E8">) </span><span style="color:#9ECBFF">Xeon</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">R</span><span style="color:#E1E4E8">) </span><span style="color:#9ECBFF">CPU</span><span style="color:#9ECBFF"> E5-2689</span><span style="color:#79B8FF"> 0</span><span style="color:#9ECBFF"> @</span><span style="color:#9ECBFF"> 2.60GHz</span></span>
<span class="line"><span style="color:#B392F0">BenchmarkSum-4</span><span style="color:#79B8FF">          1000000000</span><span style="color:#79B8FF">               0.4268</span><span style="color:#9ECBFF"> ns/op</span><span style="color:#79B8FF">          0</span><span style="color:#9ECBFF"> B/op</span><span style="color:#79B8FF">          0</span><span style="color:#9ECBFF"> allocs/op</span></span>
<span class="line"><span style="color:#B392F0">PASS</span></span>
<span class="line"><span style="color:#B392F0">ok</span><span style="color:#9ECBFF">      benchmark</span><span style="color:#9ECBFF">       0.491s</span></span>
<span class="line"></span></code></pre>
<p><code>0 B/op</code> 表明每次操作内存分配了0字节，<code>0 allocs/op</code>每次操作进行0次内存分配</p>
<h3 id="性能比较">性能比较</h3>
<p><a href="https://www.liwenzhou.com/posts/Go/unit-test/">参考文章</a></p>  <ul class="list-none flex p-0"> <a href="/tags/go" class="no-underline"> <li class="px-4 py-2 mr-3 bg-neutral-400 border border-neutral-600 rounded-md
            dark:bg-neutral-900 dark:border-none"> go </li> </a> </ul> </article> </main> <footer class="text-sm text-neutral-700 text-center py-6">
&copy; 2024&nbsp;Powered&nbsp;by
<a href="https://astro.build/">Astro</a>&nbsp;&
<a href="https://github.com/yemo0/just-my-type-blog">Just My Type</a> </footer>   </body></html>